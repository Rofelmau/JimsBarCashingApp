name: Build Qt Application (ARM64) with carlonluca/qt-dev

on:
  push:
    branches:
      - '**'

jobs:
  build:
    runs-on: ubuntu-22.04

    container:
      image: carlonluca/qt-dev:5.15.2

    steps:
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3
        with:
          platforms: arm64

      - name: Checkout code
        uses: actions/checkout@v3
        with:
          submodules: recursive

      - name: Install sqlite3 (only dependency needed)
        run: |
          apt-get update && apt-get install -y sqlite3

      - name: Build with Qt
        run: |
          export PATH=/opt/Qt-arm64-5.15.2/bin:$PATH

          mkdir -p build
          cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release
          make -j$(nproc)

      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: QtBuild
          path: build/src/MyProject
