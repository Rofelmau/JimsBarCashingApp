name: Build Qt Application for Raspberry Pi 5

on:
  push:
    branches:
      - '**'

jobs:
  build:
    name: Build Application
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Build in arm64 container
        uses: uraimo/run-on-arch-action@v3.0.0
        with:
          arch: aarch64
          base_image: carlonluca/qt-dev:5.15.2
          install: |
            apt-get update
            apt-get install -y sqlite3
          run: |
            export ARCH=aarch64  # Setze ARCH explizit
            mkdir -p build
            cd build
            cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=/opt/Qt-arm64-5.15.2/mkspecs/features/toolchain.prf 2>&1 | tee ../cmake_config_log.txt

            cat ../cmake_config_log.txt
            
            make -j$(nproc) 2>&1 | tee ../make_build_log.txt

      - name: Upload Build Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: MyProject-RaspberryPi
          path: build/src/MyProject