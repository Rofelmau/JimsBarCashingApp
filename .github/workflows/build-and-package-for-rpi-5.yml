name: Build Qt Application for Raspberry Pi 5

on:
  push:
    branches:
      - '**'

jobs:
  build:
    runs-on: ubuntu-22.04
    
    container:
      image: docker.io/carlonluca/qt-dev:5.15.2
      options: --platform linux/arm64

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          submodules: recursive
      
      - name: Set up Qt environment
        run: |
          # Setze den PATH zu den Qt-Bin√§rdateien im Container
          export PATH=/opt/Qt-arm64-5.15.2/bin:$PATH
          
          # Wechsle ins Verzeichnis mit dem Code
          cd ${GITHUB_WORKSPACE}

          # Erstelle das Build-Verzeichnis, falls es nicht existiert
          mkdir -p build
          cd build

          # Konfiguriere das Projekt mit cmake
          cmake .. -DCMAKE_BUILD_TYPE=Release

          # Baue das Projekt mit make
          make -j$(nproc)
            
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: QtBuild
          path: build/src/MyProject